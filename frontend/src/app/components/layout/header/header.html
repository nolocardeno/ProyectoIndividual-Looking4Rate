<header class="header" #headerContainer>
  <section class="header__container">
    <a routerLink="/" class="header__logo">
      <img src="assets/img/logoL4R-grande.png" alt="Looking4Rate Logo" class="header__logo-img">
    </a>

    <!-- Navegaci贸n desktop -->
    <nav class="header__actions header__actions--desktop">
      <app-theme-toggle></app-theme-toggle>
      
      <!-- Mostrar botones de login/registro si NO est谩 autenticado -->
      @if (!authState.isAuthenticated) {
        <app-button variant="primary" size="md" (btnClick)="loginClick.emit()">INICIAR SESIN</app-button>
        <app-button variant="primary" size="md" (btnClick)="registerClick.emit()">CREAR CUENTA</app-button>
      }
      
      <!-- Mostrar dropdown de usuario si S est谩 autenticado -->
      @if (authState.isAuthenticated && authState.user) {
        <app-user-dropdown
          [userName]="authState.user.nombre"
          (navigateHome)="goToHome()"
          (navigateProfile)="goToProfile()"
          (navigateSettings)="goToSettings()"
          (logoutClick)="logout()">
        </app-user-dropdown>
      }
      
      <app-search-box 
        placeholder="Buscar juegos..."
        [(value)]="searchQuery"
        (search)="onSearch($event)">
      </app-search-box>
    </nav>

    <!-- Controles m贸vil (solo visibles en m贸vil) -->
    <menu class="header__mobile-controls">
      <!-- Toggle de tema -->
      <app-theme-toggle></app-theme-toggle>
      
      <!-- Bot贸n de b煤squeda m贸vil (solo icono) -->
      <app-search-box 
        variant="icon-only"
        (iconClick)="onSearch(searchQuery)">
      </app-search-box>

      <!-- Bot贸n hamburguesa con manejo de eventos mejorado -->
      <button 
        #hamburgerBtn
        class="header__hamburger" 
        [class.header__hamburger--active]="isMenuOpen"
        (click)="toggleMenu($event)"
        (keydown)="onHamburgerKeyDown($event)"
        aria-label="Men煤 de navegaci贸n"
        [attr.aria-expanded]="isMenuOpen"
        aria-controls="mobile-menu"
        type="button">
        <span class="header__hamburger-line"></span>
        <span class="header__hamburger-line"></span>
        <span class="header__hamburger-line"></span>
      </button>
    </menu>

    <!-- Men煤 m贸vil con referencias para manipulaci贸n DOM -->
    <nav 
      #mobileMenu
      id="mobile-menu"
      class="header__mobile-menu" 
      [class.header__mobile-menu--open]="isMenuOpen"
      [attr.aria-hidden]="!isMenuOpen"
      role="menu">
      <ul class="header__mobile-menu-content">
        @if (!authState.isAuthenticated) {
          <li role="menuitem">
            <app-button variant="primary" size="lg" (btnClick)="onLoginClick()">INICIAR SESIN</app-button>
          </li>
          <li role="menuitem">
            <app-button variant="primary" size="lg" (btnClick)="onRegisterClick()">CREAR CUENTA</app-button>
          </li>
        }
        
        @if (authState.isAuthenticated && authState.user) {
          <li role="menuitem">
            <button class="header__mobile-menu-item" (click)="goToHome()" type="button">
              <fa-icon [icon]="['fas', 'home']"></fa-icon> Inicio
            </button>
          </li>
          <li role="menuitem">
            <button class="header__mobile-menu-item" (click)="goToProfile()" type="button">
              <fa-icon [icon]="['fas', 'user-circle']"></fa-icon> Perfil
            </button>
          </li>
          <li role="menuitem">
            <button class="header__mobile-menu-item" (click)="goToSettings()" type="button">
              <fa-icon [icon]="['fas', 'cog']"></fa-icon> Ajustes
            </button>
          </li>
          <li role="menuitem">
            <button class="header__mobile-menu-item header__mobile-menu-item--logout" (click)="logout()" type="button">
               Cerrar sesi贸n
            </button>
          </li>
        }
      </ul>
    </nav>

    <!-- Overlay para cerrar men煤 -->
    @if (isMenuOpen) {
      <aside 
        class="header__overlay" 
        (click)="closeMenu()" 
        aria-hidden="true"
        role="presentation">
      </aside>
    }
  </section>
</header>
