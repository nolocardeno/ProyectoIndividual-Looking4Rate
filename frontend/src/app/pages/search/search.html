<!-- Search Page: Página de resultados de búsqueda de juegos -->

<section class="search-page">
  <h1 class="visually-hidden">Búsqueda de juegos</h1>
  
  <!-- Estado de carga inicial -->
  @if (isLoading()) {
    <aside class="search-page__loading">
      <app-spinner />
    </aside>
  } @else if (hasError()) {
    <!-- Estado de error -->
    <app-empty-state
      icon="error"
      title="Error al buscar"
      message="Ha ocurrido un error al realizar la búsqueda. Por favor, inténtalo de nuevo."
    />
  } @else if (!searchQuery()) {
    <!-- Sin término de búsqueda -->
    <app-empty-state
      icon="search"
      title="Busca un juego"
      message="Introduce un término de búsqueda para encontrar juegos."
    />
  } @else if (totalResults() === 0) {
    <!-- Sin resultados -->
    <app-empty-state
      icon="search"
      title="Sin resultados"
      message="No se encontraron juegos para '{{ searchQuery() }}'. Prueba con otro término."
    />
  } @else {
    <!-- Sección de resultados usando FeaturedSection -->
    <app-featured-section [title]="'Mostrando ' + visibleResults().length + ' de ' + totalResults() + ' resultados para \u0022' + searchQuery() + '\u0022'">
      <!-- Lista de resultados -->
      <ul class="search-page__results">
        @for (game of visibleResults(); track game.id) {
          <li class="search-page__result-item">
            <app-search-game-card
              [coverSrc]="game.imagenPortada"
              [title]="game.nombre"
              [releaseYear]="getReleaseYear(game.fechaSalida)"
              [developer]="getDeveloper(game)"
              [platforms]="getPlatforms(game)"
              [gameLink]="getGameLink(game.id)"
            />
          </li>
        }
      </ul>

      <!-- Sentinel para scroll infinito -->
      @if (hasMoreResults()) {
        <output #loadMoreSentinel class="search-page__sentinel">
          @if (isLoadingMore()) {
            <aside class="search-page__loading-more">
              <app-spinner-inline size="md" />
              <p>Cargando más resultados...</p>
            </aside>
          } @else {
            <!-- Botón manual como fallback -->
            <footer class="search-page__load-more">
              <app-button
                variant="primary"
                size="lg"
                (btnClick)="showMoreResults()"
              >
                Mostrar más resultados
              </app-button>
            </footer>
          }
        </output>
      }
    </app-featured-section>
  }
</section>