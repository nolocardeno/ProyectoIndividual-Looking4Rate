<!-- Página de Detalle del Juego -->

<section class="game-detail">
  <!-- Estado de carga -->
  @if (loading()) {
    <aside class="game-detail__loading">
      <p>Cargando...</p>
    </aside>
  }

  <!-- Estado de error -->
  @if (error()) {
    <aside class="game-detail__error">
      <p>{{ error() }}</p>
      <nav class="game-detail__nav">
        <a routerLink="/buscar" class="game-detail__link">← Volver a búsqueda</a>
        <a routerLink="/" class="game-detail__link">← Volver al inicio</a>
      </nav>
    </aside>
  }

  <!-- Contenido principal -->
  @if (!loading() && !error() && game()) {
    <article class="game-detail__container">
      <!-- Fila principal: Game Card + Panel de Interacción -->
      <section class="game-detail__main">
        <!-- Game Card con información del juego -->
        <app-game-card
          [coverSrc]="game()!.imagenPortada"
          [title]="game()!.nombre"
          [releaseDate]="releaseDate"
          [developer]="developerName"
          [description]="game()!.descripcion"
          [platforms]="platforms"
        />

        <!-- Panel de interacción -->
        <app-game-interaction-panel
          [isPlayed]="isPlayed()"
          [rating]="userRating()"
          [loading]="interactionLoading()"
          [isAuthenticated]="isAuthenticated"
          [hasReview]="hasReview"
          (playedChange)="onPlayedChange($event)"
          (ratingChange)="onRatingChange($event)"
          (writeReviewClick)="onWriteReviewClick()"
        />
      </section>

      <!-- Sección de Reviews -->
      <app-featured-section
        title="REVIEWS"
        [linkRoute]="gameReviews().length > 3 ? 'reviews' : null"
      >
        @if (gameReviews().length === 0) {
          <aside class="game-detail__reviews-empty">
            <p>¡Aún no hay reviews para este juego. Sé el primero en escribir una!</p>
          </aside>
        } @else {
          <section class="game-detail__reviews-grid">
            @for (review of gameReviews().slice(0, 3); track review.id) {
              <app-user-review 
                [review]="review" 
                [isOwn]="isOwnReview(review)"
                (deleteReview)="onDeleteReview($event)"
              />
            }
          </section>
        }
      </app-featured-section>
    </article>
  }
</section>

<!-- Modal de Review -->
<app-review-form-modal
  [isOpen]="showReviewModal()"
  [gameTitle]="game()?.nombre || ''"
  [gameCover]="game()?.imagenPortada || ''"
  [gameYear]="gameYear"
  [existingReview]="existingReview"
  [loading]="reviewLoading()"
  (close)="closeReviewModal()"
  (reviewSubmit)="onReviewSubmit($event)"
/>
